<Project Sdk="Microsoft.Build.Traversal">

  <PropertyGroup>
    <TargetFramework>netcoreapp3.0</TargetFramework>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <IsSignable>true</IsSignable>
    <InnoToolVersion>6.0.2</InnoToolVersion>

    <!-- Computed paths -->
    <InnoToolPath>$(NugetPackageRoot)Tools.InnoSetup\$(InnoToolVersion)\tools\ISCC.exe</InnoToolPath>
  </PropertyGroup>

  <ItemGroup>
    <None Include="**\*" />
    <FilesToSign Include="$(InstallerFile)" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Scalar\Scalar.csproj" />
    <ProjectReference Include="..\Scalar.Mount\Scalar.Mount.csproj" />
    <ProjectReference Include="..\Scalar.Service\Scalar.Service.csproj" />
    <ProjectReference Include="..\Scalar.Service.UI\Scalar.Service.UI.csproj" />
    <ProjectReference Include="..\Scalar.Upgrader\Scalar.Upgrader.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Tools.InnoSetup" Version="$(InnoToolVersion)" PrivateAssets="all" />
  </ItemGroup>

  <!-- Only create the installer on 'publish' and when running on Windows -->
  <Target Name="CreateInstaller" AfterTargets="Publish" Condition="'$(OSPlatform)' == 'windows'" >

    <!-- Run the Inno setup tool to build the installer -->
    <Exec Command="$(InnoToolPath) /DPayloadPath=$(RepoPublishPath)\$(Configuration)\$(TargetFramework)\$(RuntimeIdentifier) /DScalarVersion=$(ScalarVersion) Setup.iss /O$(RepoPublishPath)$(Configuration)"/>

    <!-- Mark the installer file as a output for this target so that the Clean target will delete it -->
    <ItemGroup>
      <FileWrites Include="$(RepoPublishPath)$(Configuration)\SetupScalar.$(ScalarVersion).exe" />
    </ItemGroup>

  </Target>

</Project>
